rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ユーザー認証チェック用関数
    function isAuthenticated() {
      return request.auth != null;
    }

    // チャットルーム - ユーザーごとに個別のチャットルーム
    match /chatrooms/{userId} {
      // 自分のチャットルームのみアクセス可能
      allow read, write: if isAuthenticated() && request.auth.uid == userId;

      // メッセージサブコレクション
      match /messages/{messageId} {
        allow read, write: if isAuthenticated() && request.auth.uid == userId;
      }
    }

    // 既存のコレクション
    match /insurances/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /contacts/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /schedules/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /nurseryEvents/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /photos/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /settings/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /notifications/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /notices/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /messages/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /hospitals/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /events/{docId} {
      allow read, write: if isAuthenticated();
    }

    match /monthlyExpenses/{docId} {
      allow read, write: if isAuthenticated();
    }

    // 家族のメモ
    match /memos/{docId} {
      allow read, write: if isAuthenticated();
    }

    // 買い物リスト
    match /shoppingList/{docId} {
      allow read, write: if isAuthenticated();
    }

    // デフォルトでアクセス拒否
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
